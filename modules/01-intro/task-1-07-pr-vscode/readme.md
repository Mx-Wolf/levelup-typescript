# Настройка TypeScript-окружения для работы в редакторе кода

Ваша задача: настроить редактор кода для работы с TypeScript. Мы используем бесплатный VS-Code, но способ настройки подойдёт для любого редактора.

1. Установить систему контроля версий.
2. Установить компилятор TypeScript.
3. Установить и настроить систему модульного тестирования mocha/chai для определённости.
4. Установить и настроить контроль правил eslinter.

В материалах к этому заданию вы найдёте файл index.html, main.ts, main.test.ts, utils.ts и utils.test.ts. Вы сможете проверить правильность настройки, разместив эти файлы в своём проекте:

```terminal
/index.html
/src/main.ts
/src/main.test.ts
/src/utils.ts
/src/utils.test.ts
```

При правильной настройке...

```terminal
npm run test
```

... расскажет вам о результатах модульного тестирования.

После самостоятельного выполнения задания можно открыть решение авторов и сравнить получившийся результат. Для этого нажмите кнопку «Задание готово», и вам станет доступна пошаговая демонстрация эталонного решения.

Во время выполнения задания обратите внимание, что вам необходимо создать и изменить несколько файлов с настроечной информацией.

## Изменения в проекте

Вы заметите, что в вашей директории появился файл `tsconfig.json`. Откройте и изучите этот файл в редакторе.

1. В этом файле сначала нас интересует строка `"target":` Измените ее на `"target": "ES2020",`
1. Далее найдите и снимите комментарий в строке `"module":`, измените ее, чтобы она стала `"module": "ES2020"`
1. Далее найдите и снимите комментарий в строке `"outDir":`, измените ее, чтобы она стала `"outDir": "./js"`
1. Чтобы закончить конфигурацию TypeScript добавьте в tsconfig.json, перед самой последней `}` ключ и значение `"include": ["./src"]`. У вас должен получиться файл как представлено ниже (без учета комментариев)

## Для тех, кто хочет разобраться

Файл tsconfig.json является важным элементом работы в контексте TypeScript. Более того именно наличие в директории файла tsconfig.json превращает эту папку и все ее содержимое в проект TypeScript. Этот файл (tsconfig.json) содержит указания на то какой файл (какие файлы) подлежат компиляции и перечисляет настройки для компилятора.

Компиляция программы TypeScript выполняется вызовом компилятора tsc.

* **tsc** - без параметров заставляет компилятор искать ближайший вышележащий файл tsconfig.json, начиная с текущей директории.
* **tsc –p &lt;file-name>** заставляет компилятор считать проектом указанный файл. При этом другие, возможно, хранящиеся файлы tsconfig.json игнорируются

Когда проект найден (или указан) компилятор исследует json-объект с настройками и использует найденные там флаги для создания результата.

Файл *tsconfig.json* это json объект. В корне json объекта в tsconfig.json возможны свойства

`extends` - содержит указание на один или несколько файлов с базовыми настройками

`compilerOptions` - содержит объект с флагами для компилятора

`files`  - содержит список файлов проекта. Эта настройка имеет смысл, если у вас небольшое количество файлов.

`include` - содержит список файлов с указанием маски для отбора

* `*` ноль или больше символов
* `**/` любая вложенная папка
* `?` любой символ

`exclude` - содержит список файлов с указание маски, которые следует игнорировать и не включать в проект.

Файл tscofig.json может дополнять значения другого файла, что позволяет собрать в одном файле существенные настройки, и модифицировать их в зависимости от требуемого режима компиляции.

Ключ compilerOptions может быть опущен, в этом случае используются значения флагов по умолчанию. Полный список флагов доступен [https://www.typescriptlang.org/tsconfig](https://www.typescriptlang.org/tsconfig)

## Кратко о выбранных флагах компилятора  

`"target": "ES2020"` - TypeScript может создавать различный код JavaScript. Как современный, так и очень древних форматов. Значением по умолчанию для этого флага является ES3. Вы будете выбирать значение этого флага, основываясь на том какой минимальный уровень окружения вы можете гарантировать для своего приложения.

`"module": "ES2020"` - Устанавливает режим поиска и использования модулей. Для приложений под nodejs, в том числе при работе с webpack, вам скорее всего подойдет commonjs. Современные браузеры имеют встроенные загрузчики модулей, поэтому для чисто браузерных решений с асинхронной загрузкой модулей можете использовать es2020.

`"sourceMap": true` - Включает создание специальных файлов .js.map содержащих подсказки для отладчика для связи между исполняемым в браузере файлом js и оригинальным исходным кодом ts.

`"outDir": "./js"` - Указывает компилятору место для сохранения результатов компиляции. По умолчанию компилятор сохраняет результаты в директории, где он нашел файл. В результате по умолчанию и файлы .ts и результаты .js и .js.map оказываются в одной и той же директории. Нам удобнее хранить их отдельно, и мы, за одно, укажем нашу папку в .gitignore.

`"esModuleInterop": true` - Действие этого флага влияет на интерпретацию модулей созданных в commonjs /amd/umd. Мы будем использовать загрузку модулей силами браузера - этот флаг не оказывает на нас явного воздействия.

`"forceConsistentCasingInFileNames": true` - этот флаг важен для совместной разработки и при запуске программы в разных операционных системах. Установка этого флага позволяет компилятору дополнительно проверить, что имя файла в ссылке import совпадает с именем файла на диске с учетом регистра

`"strict": true` - этот флаг компилятора заставляет работать систему анализа типов на полную мощность, без послабления на случай “а я не знал, а я забыл”.

`"skipLibCheck": true`  - этот флаг позволяет компилятору сэкономить время на проверке типов из node_modules

## Настройка git и инструментов

В контексте разработки TypeScript приложений файлы исходных текстов хранятся в папке src и имеют расширения .ts, .tsx. Компилятор создает производные файлы .js. В настройках `tsconfig` мы их направили в папку js. Эту папку не следует включать в репозиторий.

Файл **.gitignore**

```text
js
```

## Линтер

Вы обращаете внимание на стиль написания исходного текста. Eslint поможет вам и в работе с typescript. Мы предлагаем базовую настройку, вы можете ее изменить, привести в соответствие с договоренностями вашей команды.

1. Установите пакеты eslint и eslint-config-htmlacademy, @typescript-eslint/eslint-plugin, @typescript-eslint/parser

2. Добавьте настройки линтера в package.json или в отдельном файле `.eslintrc.json`.

Объясните линтеру, что правила расширяют

* "htmlacademy/vanilla",
* "plugin:@typescript-eslint/eslint-recommended",
* "plugin:@typescript-eslint/recommended"

а так же что вы собираетесь использовать typescript. Некоторые правила линтера стоит переключить на их TypeScript аналоги вот таким образом

```json
{
  ///......
"rules": {
    "no-shadow": "off",
    "@typescript-eslint/no-shadow": "error"
  }
///....
}
```

## Модульное тестирование

Мы будем использовать mocha, chai как инструменты модульного тестирования.

1. Установите пакеты
    * @types/chai - декларации типов для пакета оценки результатов модульного тестирования
    * @types/chai-spies - декларации типов для пакета "подстановки" тестовых реализаций функций
    * @types/jsdom - декларации типов для пакета имитации DOM во время тестирования на node.
    * @types/jsdom-global - декларации типов для пакета имитации окна браузера во время тестирования
    * @types/mocha - декларации типов для пакета запуска модульного тестирования
    * @types/sinon - декларации типов для пакета подмены импортируемых функций
    * chai - пакет помогает в оценке результатов теста
    * chai-spies - пакет помогает заменять некоторые функции на время тестирования
    * jsdom - пакет помогает эмулировать поведение DOM в тестовых целях при тестировании на стороне node
    * jsdom-global - пакет помогает эмулировать поведение DOM в тестовых целях при тестировании на стороне node
    * mocha - платформа для запуска модульных тестов
    * sinon - пакет для эмуляции функций, методов и много чего еще в целях тестирования
    * ts-node - пакет позволяет "проще" запускать TypeScript в среде node

1. Измените настройку вашего проекта, так чтобы nodejs использовал es модули. Вы указываете тип проекта в файле package.json, добавлением на верхнем уровне ключа `type` со значением `module`. Сразу исправьте ключ scripts/test. и добавьте привычный script/start

1. Добавьте настройки mocha для работы в окружении typescript. Рекомендации можно найти [в документации](https://typestrong.org/ts-node/docs/recipes/mocha)
